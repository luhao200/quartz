---
title: 预处理器（预编译和宏）
date: 2024-04-16 22:44:26
tags: 
---

C 预处理器不是编译器的组成部分，但是它是编译过程中一个单独的步骤。

| 指令      | 描述                                                         |
|-----------|--------------------------------------------------------------|
| \#include | 包含一个源代码文件                                           |
| \#define  | 定义宏                                                       |
| \#undef   | 取消已定义的宏                                               |
| \#ifdef   | 如果宏已经定义，则返回真                                     |
| \#ifndef  | 如果宏没有定义，则返回真                                     |
| \#if      | 如果给定条件为真，则编译下面代码                             |
| \#else    | \#if 的替代方案                                              |
| \#elif    | 如果前面的 \#if 给定条件不为真，当前条件为真，则编译下面代码 |
| \#endif   | 结束一个 \#if……#else 条件编译块                              |
| \#error   | 当遇到标准错误时，输出错误消息                               |
| \#pragma  | 使用标准化方法，向编译器发布特殊的命令到编译器中             |

使用#ifndef可以避免以下错误
如果在.h文件中定义了全局变量,一个C文件包含了.h文件多次,如果不加#ifndef宏定义,会出现变量重复定义的错误;如果加了#ifndef则不会出现这种错误。

常用用法：

\#ifndef IDENTIFIER

\#define IDENTIFIER

// 在这里放置需要执行的代码

\#endif
预定义宏
ANSI C 定义了许多宏。在编程中您可以==使用这些宏==，但是==不能直接修改这些预定义的宏==。

| 宏           | 描述                                                |
|--------------|-----------------------------------------------------|
| \_\_DATE\_\_ | 当前日期，一个以 "MMM DD YYYY" 格式表示的字符常量。 |
| \_\_TIME\_\_ | 当前时间，一个以 "HH:MM:SS" 格式表示的字符常量。    |
| \_\_FILE\_\_ | 这会包含当前文件名，一个字符串常量。                |
| \_\_LINE\_\_ | 这会包含当前行号，一个十进制常量。                  |
| \_\_STDC\_\_ | 当编译器以 ANSI 标准编译时，则定义为 1。            |

预处理器运算符
宏延续运算符（\\

一个宏通常写在一个单行上。但是如果宏太长，一个单行容纳不下，则使用宏延续运算符（\\。例如：

\#define message_for(a, b) \\

printf(#a " and " \#b ": We love you!\n")

字符串常量化运算符（#）

在宏定义中，当需要把一个宏的参数转换为字符串常量时，则使用字符串常量化运算符（#）。在宏中使用的该运算符有一个特定的参数或参数列表。实例：

\#define message_for(a, b) \\

printf(#a " and " \#b ": We love you!\n")

message_for(Carole, Debra);

结果：

Carole and Debra: We love you!

标记粘贴运算符（##）

宏定义内的标记粘贴运算符（##）会==合并两个参数==。它允许在宏定义中两个独立的标记被合并为一个标记。实例：

\#define tokenpaster(n) printf ("token" \#n " = %d", token##n)

int token34 = 40;

tokenpaster(34);

结果：token34 = 40
